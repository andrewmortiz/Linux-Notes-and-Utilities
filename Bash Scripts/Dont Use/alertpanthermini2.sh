logs=$(egrep -w "(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0^C][0-9]|25[0-5])" $(lsof -p $(echo "$(pidof apache2 -s ; pidof httpd -s ; pidof nginx -s)" | tr '\n' ',') | awk '/access.*log/ {print $9}' | sort | uniq)  | grep -v "Monitor|dummy connection|server-status|127.0.0.1|localhost|^ -"
> ) && sites=$(cut -d ':' -f 1 <<< "$logs"| awk -F"/" '{print $NF}') && ips=$(awk -F":| " '{print $2}'<<< "$logs" | tr -d , ) && requests=$(awk -F"]" '{print $2}' <<< "$logs" | awk '{print $2}' | cut -c -50) && paste <(echo "$sites") <(echo "$ips") <(echo "$requests")  | sort | uniq -c | sort -nr | head -40
